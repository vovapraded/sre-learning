–û—Ç–ª–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å.  
–í–æ—Ç —á—ë—Ç–∫–æ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ (–¢–ó) –¥–ª—è –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Java, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫—Ä–æ–µ—Ç –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

---

# –ü—Ä–æ–µ–∫—Ç: Distributed Metrics Storage with Monitoring

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞:
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Java, –∫–æ—Ç–æ—Ä–æ–µ:
- —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Kubernetes,
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Istio –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏,
- –¥–µ–ø–ª–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ Helm,
- —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus,
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç promQL –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–µ—Ç—Ä–∏–∫–∞–º,
- –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏,
- —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ 4 Golden Signals, RED, USE.

---

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:
- Java 21 (–∏–ª–∏ 17) + Spring Boot 3.x
- Kubernetes (k3d, minikube –∏–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä)
- Istio (Ingress Gateway + Traffic Shaping)
- Helm (–¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —á–∞—Ä—Ç–∞ –¥–µ–ø–ª–æ—è)
- Prometheus (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- Grafana (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫)
- PostgreSQL –∏–ª–∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–∏–ø–∞ H2
- Docker (—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
- Prometheus Java Client (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫)
- Distributed Data Replication ‚Äî —á–µ—Ä–µ–∑ REST –∏–ª–∏ Event-Driven –º–æ–¥–µ–ª—å.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

- 3 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:
    - NodeService ‚Äî —ç–º—É–ª–∏—Ä—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.
    - GatewayService ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã, —Ä–æ—É—Ç–∏—Ç –∏—Ö –Ω–∞ NodeService.
    - MonitorService ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±–æ–±—â–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏.

- –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö: –∑–∞–ø–∏—Å—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ GatewayService, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ 2+ NodeService –∏–Ω—Å—Ç–∞–Ω—Å–∞.

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
    - –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ–Ω–∏—Ä—É–µ—Ç /actuator/prometheus —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏: latency, throughput, error rate, saturation.
    - Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º —á–µ—Ä–µ–∑ ServiceDiscovery.

- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
    - –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –æ–¥–Ω—É –Ω–æ–¥—É, –æ–Ω–∞ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏ —á–µ—Ä–µ–∑ REST-–≤—ã–∑–æ–≤—ã.
    - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º "Eventually Consistent" (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å/—Ç–∞—Å–∫—É).

- –û—à–∏–±–∫–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:
    - –ò–º–∏—Ç–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Istio Fault Injection).

- Helm Chart:
    - –ß–∞—Ä—Ç –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–ø–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ + Prometheus + Grafana + Istio Gateway.

---

## –ß—Ç–æ –±—É–¥–µ—Ç –ø–æ–∫—Ä—ã—Ç–æ:

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö–∞–∫ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è |
|:---|:---|
| Prometheus + promQL | –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è Prometheus'–æ–º, –∑–∞–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞ promQL –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏). |
| 4 Golden Signals | –ú–µ—Ç—Ä–∏–∫–∏: Latency (–∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞), Traffic (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤), Errors (–∫–æ–ª-–≤–æ –æ—à–∏–±–æ–∫), Saturation (–Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã). |
| RED | Response time, Error rate, Request rate ‚Äî –≤—Å–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ Prometheus. |
| USE | –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤: –∑–∞–≥—Ä—É–∑–∫–∞ CPU, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ Node Exporter –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏. |
| Cloud –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Kubernetes, Istio, Helm) | –î–µ–ø–ª–æ–π –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ Helm –Ω–∞ Kubernetes, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª —á–µ—Ä–µ–∑ Istio. |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ | NodeService —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ, —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–º NodeService. |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | REST-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–¥–Ω—É –∏–∑ –Ω–æ–¥. |

---

## –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ:

1. NodeService:
    - POST /data ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å –∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –µ—ë –¥—Ä—É–≥–∏–º NodeService.
    - GET /data/{key} ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å—å.
    - –ö–∞—Å—Ç–æ–º–Ω—ã–µ Prometheus –º–µ—Ç—Ä–∏–∫–∏:
        - latency –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è,
        - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

2. GatewayService:
    - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.
    - –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ NodeService (–Ω–∞–ø—Ä–∏–º–µ—Ä, round-robin –∏–ª–∏ random).
    - –ú–µ—Ç—Ä–∏–∫–∏ RED –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

3. MonitorService:
    - –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫.
    - –≠–∫—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ health-check –º–µ—Ç—Ä–∏–∫.

4. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
    - –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Å–µ—Ä–≤–∏—Å —Å–∞–º –¥–µ–ª–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã NodeService.
    - –õ–æ–≥–∏–∫–∞ "–∫–∞–∫–∞—è-—Ç–æ –Ω–æ–¥–∞ –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ —É–ø–∞—Å—Ç—å" ‚Äî —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ retry/backoff.

5. Monitoring:
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus scrape targets.
    - –í Grafana –¥–∞—à–±–æ—Ä–¥–µ –ø–æ–∫–∞–∑–∞—Ç—å:
        - Latency –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º.
        - –û—à–∏–±–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
        - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
        - 
6. Kubernetes + Istio:
    - Ingress —á–µ—Ä–µ–∑ Istio Gateway.
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å fault injection (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–µ 10% –æ—à–∏–±–æ–∫ –∏–ª–∏ 500ms –∑–∞–¥–µ—Ä–∂–∫–∏).

7. Helm:
    - –û–¥–∏–Ω —á–∞—Ä—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π:
        - –î–µ–ø–ª–æ–π –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
        - Prometheus –∏ Grafana.
        - Istio Gateway + VirtualService + DestinationRule.

---

## –ë–æ–Ω—É—Å–Ω—ã–µ –∏–¥–µ–∏:
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ PostgreSQL/H2.
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ cron –∑–∞–¥–∞—á–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏).
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Circuit Breaker –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö —á–µ—Ä–µ–∑ Resilience4j –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã Istio.

---

## –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç:

–ö–æ–≥–¥–∞ —Ç—ã –±—É–¥–µ—à—å –ø—Ä–µ–∑–µ–Ω—Ç–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –º–æ–∂–Ω–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å:

- "–Ø –ø–æ—Å—Ç—Ä–æ–∏–ª –º–∏–Ω–∏-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –ë–î —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π, –∑–∞—Ç–æ—á–µ–Ω–Ω—É—é –ø–æ–¥ –ø—Ä–∏–Ω—Ü–∏–ø—ã Golden Signals, RED, USE."
- "–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è promQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–µ—Ç—Ä–∏–∫ –∑–∞–¥–µ—Ä–∂–µ–∫, –æ—à–∏–±–æ–∫, —Ç—Ä–∞—Ñ–∏–∫–∞."
- "–Ø —Ä–∞–∑–≤–µ—Ä–Ω—É–ª –≤—Å—ë –≤ Kubernetes —Å –ø–æ–º–æ—â—å—é Helm, –Ω–∞—Å—Ç—Ä–æ–∏–ª Istio –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–æ–º –∏ –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–±–æ–µ–≤."
- "–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å backoff/retry."
- "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ Prometheus –∏ Grafana, —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫."

---

–•–æ—á–µ—à—å, —è –µ—â—ë –Ω–∞–ø–∏—à—É –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (`/src`, /helm, /k8s, `/docker`) –∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞? üöÄ  
–•–æ—á–µ—à—å, –µ—â—ë –∑–∞–∫–∏–Ω—É –ø—Ä–∏–º–µ—Ä—ã promQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞?